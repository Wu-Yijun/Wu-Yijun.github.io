<!DOCTYPE html>
<html>

<head>
    <title>主页 | HomePage</title>
    <!-- <link href="./include/highlight.js/styles/default.min.css" rel="stylesheet" type="text/css"> -->
    <link href="./Include-Outer/highlight.js/styles/docco.css" rel="stylesheet" type="text/css">
    <link href="./include/layout-style.css" rel="stylesheet" type="text/css">
    <link href="./include/index-style.css" rel="stylesheet" type="text/css">
    <script src="./include/itemManager.js"></script>
    <!-- <script src="include/three.js"></script> -->
</head>

<body>
    <!-- <div id="base"></div>   -->
    <div class="body-container">
        <div class="tool-bar-container">
            <div class="tool-bar-contents">
                <div class="menu-icon click-to-switch"></div>
                <div class="homepage click-to-switch"></div>
                <div class="homepage click-to-switch"></div>
                <div class="homepage click-to-switch"></div>
            </div>
            <div class="tool-bar-contents-detailed"></div>
        </div>
        <div class="main-contents-container">
            <div class="header-container">
                <div>
                    123asidijasljlaskjdklajdklajsdkl<br>jdklajdklsandkasdjklajlkdjlkfjklsaklasqwueiojakldsjakldjlaskdadlkasdljd
                </div>
                <div>
                    看不见我，看不见我，我不是背景,看不见我，看不见我，我是背景,看不见我，看不见我，我是不背景看不见我，看不见我，我不是背景,看不见我，看不见我，我不是背景看不见我，看不见我，我不是背景看不见我，看不见我，我不是背景
                </div>
                <div>我们仨都是页面标题哦</div>
            </div>
            <div class="title-container">
                <div>目录结构：</div>
            </div>
            <div class="item-container">
                <div class="item-entry">
                    <data value="???"></data>
                    <div class="item-header">你好，世界!</div>
                    <div class="tag-list" id="test2"></div>
                    <div class="item-description zh">
                        这是这个内容的描述，这是这个内容的描述，这是这个内容的描述，<br>
                        这是这个内容的描述，这是这个内容的描述，<br>
                        这是这个内容的描述，<br>
                        这是这个内容的描述，这是这个内容的描述，这是这个内容的描述，<br>
                        这是这个内容的描述，这是这个内容的描述，<br>
                        这是这个内容的描述， </div>
                </div>
                <div class="item-entry">
                    <data value="???"></data>
                    <div class="item-header">你好，世界2!</div>
                    <div class="item-description">关于2....</div>
                    <div class="item-description zh">关于3....</div>
                    <div class="item-description">关于4....</div>
                    <div class="item-description">关于5....</div>
                    <div class="item-description zh">关于6....</div>
                    <div class="item-description">关于7....</div>
                    <div class="item-description zh">关于为什么没有"关于1"，关于为什么缩进是引入了 zh 类，以及关于为什么可以这么多行是因为有多个div标签</div>
                </div>
                <div class="item-entry">
                    <data value="???"></data>
                    <div class="item-header">你好，世界3! 关于我这个标题太长了在一行显示不下以至于在后面出现了省略号
                        因此你看到的其实这不是我完整的标题这件事实在是太难受了于是我把标题也在了描述里抄了一遍这件事</div>
                    <div class="item-description">完整标题为：《你好，世界3! 关于我这个标题太长了在一行显示不下以至于在后面出现了省略号
                        因此你看到的其实这不是我完整的标题这件事实在是太难受了于是我把标题也在了描述里抄了一遍这件事》。
                        上面的书名号中就是完整的标题它多半是显示不下的，于是在标题处出现了省略号，但这没关系只要没搞乱排版就OK。
                        为什么我要写如此奇怪的标题呢，因为我只是想测试一下各种特殊情况下
                        如果还是显示不下这些描述那我建议你缩小页面，但我想你大概也是看不到我的提示的。反正就这样了你来咬我啊？</div>
                </div>
                <div class="item-entry">
                    <data value="???"></data>
                    <div class="item-header">我没有描述</div>
                    <div class="item-description"></div>
                </div>
                <div class="item-entry">
                    <data value="???"></data>
                    <div class="item-header"></div>
                    <div class="item-description">我没有标题</div>
                </div>
            </div>
            <div class="paragraphs-container">
                <p>千古兴亡多少事？</p>
                <p>悠悠。</p>
                <p>不尽长江滚滚流。</p>
                <div class="paragraphs zh">测试段落
                    <div>段落内容1段落内容1段落内容1段落内容1段落内容1段落内容1段落内容1段落内容1段落内容1段落内容1段落内容1</div>
                    <div>段落内容2段落内容2段落内容2段落内容2段落内容2段落内容2段落内容2段落内容2段落内容2段落内容2段落内容2段落内容2段落内容2</div>
                    <div>段落内容3</div>
                </div>
                <div class="paragraphs">测试段落2
                    <div>段落2内容1段落2内容1段落2内容1段落2内容1段落2内容1段落2内容1段落2内容1段落2内容1段落2内容1段落2内容1段落2内容1</div>
                    <div>段落2内容2段落2内容2段落2内容2段落2内容2段落2内容2段落2内容2段落2内容2段落2内容2段落2内容2段落2内容2段落2内容2</div>
                    <div>段落2内容3</div>
                </div>
            </div>
            <div class="code-container noscroll" type="javascript">
                <pre>import hljs from './Include-Outer/highlight.js/es/core.js';
import javascript from './include/highlight.js/es/l anguages/javascript.js';

// this is a line that is toooo oooooooooo oooooo ooooooo ooooooooooo looooooooo ooooooooooooooo ooooooooo ooooooooo oooong and it is sooooooooooooooooooo ooooooooooooooooooo coooooooooooooooooooo ooooooooooooooooooooo ooooooooooooooooooooooool
window.onload = () => {
    // Using require
    // const hljs = require('highlight.js/lib/core');

    // Load any languages you need
    hljs.registerLanguage('javascript', javascript);

    hljs.highlightAll();
}</pre>
            </div>
            <div class="code-container" type="javascript">
                <pre>import hljs from './include/highlight.js/es/core.js';
import javascript from './include/highlight.js/es/l anguages/javascript.js';

// this is a line that is toooo oooooooooo oooooo ooooooo ooooooooooo looooooooo ooooooooooooooo ooooooooo ooooooooo oooong and it is sooooooooooooooooooo ooooooooooooooooooo coooooooooooooooooooo ooooooooooooooooooooo ooooooooooooooooooooooool
window.onload = () => {
    // Using require
    // const hljs = require('highlight.js/lib/core');

    // Load any languages you need
    hljs.registerLanguage('javascript', javascript);

    hljs.highlightAll();
}</pre>
            </div>
            <div class="paragraphs-container zh">
                <div class="paragraphs">测试段落3
                    <div>别废话，看代码：</div>
                    <div class="code-container noscroll" id="loaded-code" type="cpp"></div>
                    <div>这是在正文中的代码，而非单独的代码块。且使用了缩进，未影响代码。代码后的一些正文...</div>
                </div>
            </div>
            <div class="ending-container">
                <div>以上。</div>
            </div>
            <div class="comment-container">
                <div class="comment-header">
                    <div>评论区</div>
                    <div class="Github-Login cur-ptr">
                        <!-- if you enable commentManager.config.gitinfo.drawLoginIcon=true -->
                        <!-- you don't need to fill contents -->
                        <!-- js will generate automatically -->
                    </div>
                </div>
                <div class="comment-contents">
                    <!-- needless to fill contents -->
                    <!-- js will generate automatically -->
                </div>
                <div class="comment-textarea">
                    <!-- needless to fill contents -->
                    <!-- js will generate automatically -->
                </div>
                <div class="comment-footer">
                    <div>评论区末尾</div>
                </div>
                <script type="module">
                    import commentManager from '/include/comment/commentManager.mjs';
                    const cm = new commentManager({
                        htmlString: await (await fetch('/include/comment/comment-item.html')).text(),
                        htmlTextarea: await (await fetch('/include/comment/comment-textarea-item.html')).text(),
                        gitinfo: {
                            Owner: 'Wu-Yijun',
                            Repo: 'git-comment',
                            Issue: '4',
                            CorsUrl: 'https://cors-anywhere.azm.workers.dev/',
                            Scope: 'public_repo',
                            GitLoginClass: 'Github-Login',
                            drawLoginIcon: true,
                            ClientID: "dbcd04607ec374d71003",
                            ClientSecret: "10d91bdc6fc31ebccc2cf4a9a8f64365e78e24eb",
                            Url: location.href,
                        },
                    });
                </script>
            </div>
            <div class="page-foot-container">
                <div>文档末尾 </div>
                <div>copyright@Rimor Aluria</div>
                <div>All rights reserved</div>
            </div>
            <div class="no-more-foot">
                <div>没有更多了。</div>
            </div>
        </div>
    </div>
    <div class="background-container">
        <div>看不见我，看不见我，我是背景</div>
        <div>看不见我，看不见我，我是背景</div>
        <div>看不见我，看不见我，我是背景</div>
        <div>看不见我，看不见我，我是背景</div>
        <div>看不见我，看不见我，我是背景</div>
    </div>
    <script>
        window.addEventListener("load", InitializeLayout);
    </script>
    <script type="module">
        import hljs from '/Include-Outer/highlight.js/es/core.js';
        import javascript from '/Include-Outer/highlight.js/es/languages/javascript.js';
        import cpp from '/Include-Outer/highlight.js/es/languages/cpp.js';

        function addLineNumbers(element) {
            let spans = element.firstElementChild.firstElementChild;
            let codes = element.lastElementChild.firstElementChild;
            var codeHeigth = window.getComputedStyle(codes).height;
            spans.parentElement.style.height = codeHeigth;
            if (codes.childElementCount == 0)
                return;
            if (!element.getAttribute("class").includes("noscroll")) {
                let lines = codes.innerHTML.split("\n").length;
                let i = 0;
                while (i++ < lines) {
                    let sp = document.createElement("span");
                    sp.innerText = i;
                    spans.appendChild(sp);
                }
                return;
            }
            // 方法：把每一个裸露的文本都用 span 包裹起来，然后计算 y 高度
            let str = "";
            for (let cd of codes.childNodes) {
                if (cd instanceof Text) str += `<span>${cd.data}</span>`;
                else str += cd.outerHTML;
            }
            codes.innerHTML = str;
            codeHeigth = 0;
            function refreshLineNumber() {
                let nowHei = window.getComputedStyle(codes).height;
                if (nowHei == codeHeigth)
                    return;
                else
                    codeHeigth = nowHei;

                spans.parentElement.style.height = codeHeigth;
                let str = "";
                // 现在没有裸露的文本的，对于每一个 span 计算高度和换行符数量。
                let lineHeight = parseFloat(window.getComputedStyle(codes.firstElementChild, null).lineHeight);
                let lastTop = parseFloat(codes.firstElementChild.offsetTop) - lineHeight;
                let leftNumber = 1, lineNumber = 1;
                for (let cd of codes.childNodes) {
                    let lines = Math.round((cd.offsetTop - lastTop) / lineHeight);
                    lastTop = cd.offsetTop;
                    let newls = cd.innerHTML.split("\n").length - 1;
                    // console.log(newls, lines ,cd.innerHTML);
                    while (lines-- > 0.5) {
                        if (leftNumber > 0.5) {
                            leftNumber--;
                            // console.log();
                            str += `<span>${lineNumber++}</span>`;
                            continue;
                        }
                        str += `<span> </span>`;
                    }
                    leftNumber += newls;
                }
                let lines = Math.round(parseFloat(codeHeigth) / lineHeight) - 1;
                lines -= Math.round((lastTop - codes.firstElementChild.offsetTop) / lineHeight);
                while (lines-- > 0.5) {
                    if (leftNumber > 0.5) {
                        leftNumber--;
                        // console.log();
                        str += `<span>${lineNumber++}</span>`;
                        continue;
                    }
                    str += `<span> </span>`;
                }
                spans.innerHTML = str;
                console.log("resized");
            }
            refreshLineNumber();
            window.addEventListener("resize", () => setTimeout(refreshLineNumber, 1000));
        }

        window.addEventListener("load", () => {
            hljs.registerLanguage('javascript', javascript);
            hljs.registerLanguage('cpp', cpp);

            let lan = "cpp";
            let dom = document.getElementById("loaded-code");
            fetch("./assets/test_code.cpp")
                .then((response) => response.text())
                .then((data) => {
                    let str = hljs.highlight(data, { language: lan }).value;
                    dom.innerHTML = `<div class="span-list"><div class="code-line-number"></div></div>` +
                        `<pre class="code"><code class="language-${lan} hljs">${str}</code></pre>`;
                    addLineNumbers(dom);
                });
            // Using require
            // const hljs = require('highlight.js/lib/core');
            for (let e of document.getElementsByClassName("code-container")) {
                let lan = e.getAttribute("type");
                if (!e.hasChildNodes() || e.firstElementChild.tagName != 'PRE')
                    continue;
                let str = hljs.highlight(e.firstElementChild.innerHTML, { language: lan }).value;
                e.innerHTML = `<div class="span-list"><div class="code-line-number"></div></div>` +
                    `<pre class="code"><code class="language-${lan} hljs">${str}</code></pre>`;
                addLineNumbers(e);
            }
        });
    </script>
</body>

</html>